<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D3 World Map</title>
    <style>
        .tooltip {
            position: absolute;
            text-align: center;
            width: 120px;
            height: auto;
            padding: 5px;
            font: 12px sans-serif;
            background: lightsteelblue;
            border: 0px;
            border-radius: 8px;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://d3js.org/topojson.v3.min.js"></script>
    <script src="world-110m.v1.json"></script> <!-- This JSON file should be included in your project -->
    <script>
        d3.csv("/mnt/data/AllPeoplesByCountry.csv").then(data => {
            var width = 960, height = 600;
            var projection = d3.geoMercator().scale(150).translate([width / 2, height / 1.5]);
            var path = d3.geoPath().projection(projection);

            var svg = d3.select("#map").append("svg")
                        .attr("width", width)
                        .attr("height", height);

            var tooltip = d3.select("body").append("div")
                            .attr("class", "tooltip")
                            .style("opacity", 0);

            d3.json("world-110m.v1.json").then(world => {
                svg.append("g")
                   .selectAll("path")
                   .data(topojson.feature(world, world.objects.countries).features)
                   .enter().append("path")
                   .attr("d", path)
                   .attr("class", "country")
                   .on("mouseover", function(event, d) {
                       var countryData = data.find(country => country.Country === d.properties.name);
                       if (countryData) {
                           tooltip.transition().duration(200).style("opacity", .9);
                           tooltip.html("Country: " + countryData.Country + "<br/>Population: " + countryData.Population + "<br/>Primary Language: " + countryData.PrimaryLanguage)
                                  .style("left", (event.pageX + 5) + "px")
                                  .style("top", (event.pageY - 28) + "px");
                       }
                   })
                   .on("mouseout", function(d) {
                       tooltip.transition().duration(500).style("opacity", 0);
                   });
            });
        });
    </script>
</body>
</html>
